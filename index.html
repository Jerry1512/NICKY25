<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NICKY25</title>

<!-- Preload important assets so they appear reliably -->
<link rel="preload" href="assets/KaiseHua.mp3" as="audio">
<link rel="preload" href="assets/intro.jpeg" as="image">
<link rel="preload" href="assets/ima1.jpeg" as="image">
<link rel="preload" href="assets/ima2.jpeg" as="image">
<link rel="preload" href="assets/ima3.jpeg" as="image">
<link rel="preload" href="assets/SCREEN3.jpeg" as="image">
<link rel="preload" href="assets/SCREEN5.jpeg" as="image">
<link rel="preload" href="assets/ONE.jpeg" as="image">
<link rel="preload" href="assets/TWO.jpeg" as="image">
<link rel="preload" href="assets/THREE.jpeg" as="image">

<style>
:root{
  --white:#ffffff;
  --glass:rgba(255,255,255,0.12);
  --bg:#031226;
}
*{box-sizing:border-box}
html,body{
  height:100%;width:100%;margin:0;background:var(--bg);
  font-family:Poppins,system-ui,Arial;overflow:hidden;-webkit-tap-highlight-color:transparent;
}

/* screens */
.screen{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;opacity:0;pointer-events:none;transition:opacity .45s ease}
.screen.active{opacity:1;pointer-events:auto}
.bg{position:absolute;inset:0;background-size:cover;background-position:center;filter:brightness(.92);z-index:0}
.wrap{position:relative;z-index:6;width:92%;max-width:960px;margin:0 auto;text-align:center;color:var(--white)}

/* screen1 */
#screen1 .wrap{padding-top:12vh}
.title1{font-size:clamp(20px,6vw,36px);font-weight:900;text-shadow:0 10px 30px rgba(0,20,40,0.7)}
.subtitle1{font-size:clamp(12px,3.4vw,18px);opacity:.95;margin-top:.4rem}
.tap-btn{margin-top:1.2rem;padding:.9rem 2.6rem;border-radius:28px;border:0;background:linear-gradient(180deg,rgba(255,255,255,0.08),rgba(255,255,255,0.03));backdrop-filter:blur(6px);box-shadow:0 12px 40px rgba(10,30,60,0.3);color:var(--white);font-weight:800;cursor:pointer;outline:none}

/* panels (screen2 & screen4) */
.panel-container{width:92%;height:86%;display:flex;flex-direction:column;gap:18px;padding:3vh 0;justify-content:space-between;z-index:5}
.panel{height:30%;min-height:100px;border-radius:14px;overflow:visible;position:relative;cursor:pointer;perspective:1400px}
.panel-inner{position:relative;width:100%;height:100%;transform-style:preserve-3d;transition:transform .6s cubic-bezier(.2,.9,.28,1);border-radius:12px;overflow:hidden;box-shadow:0 16px 50px rgba(0,20,40,0.35);}

/* flip state rotates the panel-inner */
.panel.flipped .panel-inner{transform:rotateY(180deg)}

/* faces */
.face{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;overflow:hidden}
.front{z-index:1;transform:rotateY(0deg);backface-visibility:hidden}          /* backface hidden */
.front img{width:100%;height:100%;object-fit:cover;display:block}
.front .overlay-title{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:clamp(14px,4vw,20px);z-index:3;background:transparent;pointer-events:none}

/* BACK SIDE */
.back{transform:rotateY(180deg);display:flex;align-items:center;justify-content:center;padding:18px;text-align:center;background:rgba(0,0,0,0.18);backface-visibility:hidden} /* backface hidden */
.back .blur-image{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:blur(8px) brightness(.85);transform:scale(1.02);z-index:1}
.back .panel-text{position:relative;z-index:3;font-size:clamp(12px,3vw,18px);line-height:1.45;text-shadow:0 6px 18px rgba(0,0,0,0.6);color:white}

/* When flipped we raise the back over the front to avoid front showing through */
.panel.flipped .front{z-index:0}
.panel.flipped .back{z-index:2}

/* letter page */
.letter-wrap{width:92%;max-width:920px;background:rgba(255,255,255,0.06);backdrop-filter:blur(6px);border-radius:14px;padding:26px;color:#fff;box-shadow:0 20px 60px rgba(0,20,40,0.5);z-index:5}
.letter-title{font-size:clamp(22px,5vw,36px);font-weight:900;margin-bottom:12px}
.letter-text{font-size:clamp(14px,3.4vw,18px);line-height:1.6;white-space:pre-wrap;text-align:left}
.letter-overlay{position:absolute;inset:0;cursor:pointer;z-index:7}

/* screen5 slideshow + final lines spacing */
#slides-wrap{position:absolute;inset:0;z-index:0;overflow:hidden}
.slide{position:absolute;inset:0;background-size:cover;background-position:center;filter:blur(8px) brightness(.82);opacity:0;transition:opacity 1s ease}
.slide.show{opacity:1}
.final-line{color:#fff;font-weight:800;font-size:clamp(18px,4vw,30px);opacity:0;transform:translateY(10px);transition:opacity .9s,transform .9s;margin:14px 0} /* slightly larger spacing */

/* small visible fallback play button if audio is blocked */
#playFallback{
  position:fixed;right:18px;bottom:18px;z-index:9999;padding:.6rem 1rem;border-radius:8px;background:#fff;color:#031226;font-weight:700;border:none;display:none;box-shadow:0 8px 30px rgba(0,0,0,0.35);
}

/* responsive */
@media(max-width:420px){ .panel{height:28vh} .letter-text{text-align:center} }
</style>
</head>
<body>

<!-- AUDIO (must exist in assets folder) -->
<audio id="bgm" src="assets/KaiseHua.mp3" preload="auto" autoplay muted loop></audio>
<!-- visible fallback if browser refuses play — user can tap it to start audio -->
<button id="playFallback" aria-hidden="true">Play music</button>

<!-- SCREEN 1 -->
<section id="screen1" class="screen active" aria-label="Intro">
  <div class="bg" style="background-image:url('assets/intro.jpeg')"></div>
  <div class="wrap">
    <div class="title1">HAPPY BIRTHDAY JANUDI</div>
    <div class="subtitle1">A SPECIAL DAY FOR THE LOVE OF MY LIFE</div>
    <button id="openBtn" class="tap-btn" aria-label="Tap to open">TAP TO OPEN</button>
  </div>
</section>

<!-- SCREEN 2 -->
<section id="screen2" class="screen" aria-hidden="true">
  <div class="bg" style="background-image:url('assets/SCREEN3.jpeg')"></div>
  <div class="panel-container">
    <!-- Panel 1 -->
    <div class="panel" id="p2-1" role="button" tabindex="0" data-index="1">
      <div class="panel-inner">
        <div class="face front">
          <img src="assets/ima1.jpeg" alt="ima1 front" decoding="async">
        </div>
        <div class="face back">
          <img class="blur-image" src="assets/ima1.jpeg" alt="ima1 blur" decoding="async">
          <div class="panel-text">
            Happiest birthday Nicky, always stay happy.<br>
            You’re one of the most precious parts of my life.<br>
            Every moment with you feels warm, soft, and safe.<br>
            Tap the 2nd image UMAHH.
          </div>
        </div>
      </div>
    </div>

    <!-- Panel 2 -->
    <div class="panel" id="p2-2" role="button" tabindex="0" data-index="2">
      <div class="panel-inner">
        <div class="face front">
          <img src="assets/ima2.jpeg" alt="ima2 front" decoding="async">
        </div>
        <div class="face back">
          <img class="blur-image" src="assets/ima2.jpeg" alt="ima2 blur" decoding="async">
          <div class="panel-text">
            Your smile, your heart, your softness…<br>
            I fall for them a little more every day.
          </div>
        </div>
      </div>
    </div>

    <!-- Panel 3 -->
    <div class="panel" id="p2-3" role="button" tabindex="0" data-index="3">
      <div class="panel-inner">
        <div class="face front">
          <img src="assets/ima3.jpeg" alt="ima3 front" decoding="async">
        </div>
        <div class="face back">
          <img class="blur-image" src="assets/ima3.jpeg" alt="ima3 blur" decoding="async">
          <div class="panel-text">
            No matter where life takes us,<br>
            my feelings for you will always stay the same—<br>
            pure, patient, gentle, and true.
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- SCREEN 3 -->
<section id="screen3" class="screen" aria-hidden="true">
  <div class="bg" style="background-image:url('assets/ima3.jpeg')"></div>
  <div class="wrap letter-wrap" role="article">
    <div class="letter-title">HAPPIEST BIRTHDAY JANUDIIII.</div>
    <div class="letter-text">
If I could describe what you mean to me.
I would say you're a rare kind of warmth—the kind that stays with me even on the coldest days.
You make life softer, happier, and more meaningful just by being in it.
I'm grateful for you in ways words will never fully express.
Thank you for being you.
for being real.
for being someone my heart chose without hesitation.
I may not always say it perfectly, and I may not always express everything the right way…
but every word I write for you, every feeling I share —
it all comes from a place that is real inside me.
    </div>
  </div>
  <div class="letter-overlay" onclick="showScreen('screen4')"></div>
</section>

<!-- SCREEN 4 -->
<section id="screen4" class="screen" aria-hidden="true">
  <div class="bg" style="background-image:url('assets/SCREEN5.jpeg')"></div>
  <div class="panel-container">
    <!-- 4-1 -->
    <div class="panel" id="p4-1" role="button" tabindex="0">
      <div class="panel-inner">
        <div class="face front">
          <img src="assets/ONE.jpeg" alt="one front" decoding="async">
          <div class="overlay-title" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:clamp(14px,4vw,20px);z-index:3;pointer-events:none">
            WHY I LOVE YOU
          </div>
        </div>
        <div class="face back">
          <img class="blur-image" src="assets/ONE.jpeg" alt="one blur" decoding="async">
          <div class="panel-text">I love you because you never give up on us.</div>
        </div>
      </div>
    </div>

    <!-- 4-2 -->
    <div class="panel" id="p4-2" role="button" tabindex="0">
      <div class="panel-inner">
        <div class="face front">
          <img src="assets/TWO.jpeg" alt="two front" decoding="async">
          <div class="overlay-title" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:clamp(14px,4vw,20px);z-index:3;pointer-events:none">
            MY PROMISES TO YOU
          </div>
        </div>
        <div class="face back">
          <img class="blur-image" src="assets/TWO.jpeg" alt="two blur" decoding="async">
          <div class="panel-text">I promise I'll never let a girl come between us.</div>
        </div>
      </div>
    </div>

    <!-- 4-3 -->
    <div class="panel" id="p4-3" role="button" tabindex="0">
      <div class="panel-inner">
        <div class="face front">
          <img src="assets/THREE.jpeg" alt="three front" decoding="async">
          <div class="overlay-title" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:clamp(14px,4vw,20px);z-index:3;pointer-events:none">
            THE FUTURE I WANT WITH YOU
          </div>
        </div>
        <div class="face back">
          <img class="blur-image" src="assets/THREE.jpeg" alt="three blur" decoding="async">
          <div class="panel-text">
            We get married with our parents' permission and work hard.<br>
            We have our own house.<br>
            Every morning we wake up beside each other.
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- SCREEN 5 -->
<section id="screen5" class="screen" aria-hidden="true">
  <div id="slides-wrap">
    <div class="slide" style="background-image:url('assets/intro.jpeg')"></div>
    <div class="slide" style="background-image:url('assets/ima1.jpeg')"></div>
    <div class="slide" style="background-image:url('assets/ima2.jpeg')"></div>
    <div class="slide" style="background-image:url('assets/ima3.jpeg')"></div>
    <div class="slide" style="background-image:url('assets/SCREEN3.jpeg')"></div>
    <div class="slide" style="background-image:url('assets/SCREEN5.jpeg')"></div>
    <div class="slide" style="background-image:url('assets/ONE.jpeg')"></div>
    <div class="slide" style="background-image:url('assets/TWO.jpeg')"></div>
    <div class="slide" style="background-image:url('assets/THREE.jpeg')"></div>
  </div>

  <div class="wrap" style="z-index:6">
    <div class="final-line" id="line1">WITH ALL MY LOVE (:</div>
    <div class="final-line" id="line2">FOREVER YOURS....</div>
    <div class="final-line" id="line3">THANK YOU FOR LETTING ME LOVE YOU...><</div>
    <div class="final-line" id="line4">SOME LOVE STORIES DON'T NEED WORDS... OURS IS ONE OF THEM>>></div>
    <div class="final-line" id="line5">YOURS JERRY</div>
  </div>
</section>

<script>
/* ------------ screen helper ------------ */
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>{
    s.classList.remove('active');
    s.setAttribute('aria-hidden','true');
  });
  const el = document.getElementById(id);
  if(!el) return;
  el.classList.add('active');
  el.removeAttribute('aria-hidden');

  if(id === 'screen5'){ setTimeout(()=> startFinalLoop(), 350); }
}

/* ------------ audio: robust unlock ------------ */
const bgm = document.getElementById('bgm');
bgm.volume = 1; // at full volume
const openBtn = document.getElementById('openBtn');
const playFallback = document.getElementById('playFallback');

async function tryPlayAudio(){
  try{
    bgm.muted = false;
    await bgm.play();                // attempt playback
    playFallback.style.display = 'none';
    playFallback.setAttribute('aria-hidden','true');
    return true;
  }catch(e){
    // If browser blocks autoplay, show small fallback button
    playFallback.style.display = 'block';
    playFallback.setAttribute('aria-hidden','false');
    return false;
  }
}

// primary attempt: when user presses TAP TO OPEN
openBtn.addEventListener('click', async ()=>{
  const ok = await tryPlayAudio();
  // advance to next screen regardless; fallback button will allow user to start audio manually
  showScreen('screen2');
});

// fallback button: visible when auto-unlock failed
playFallback.addEventListener('click', async ()=>{
  await tryPlayAudio();
});

// extra safety: try to unlock on the first user gesture anywhere
['click','touchstart','keydown','scroll'].forEach(ev=>{
  const handler = async function(){ await tryPlayAudio(); document.removeEventListener(ev, handler); };
  document.addEventListener(ev, handler, {passive:true});
});

/* ------------ panel flipping logic (whole panel flips) ------------ */
function setupFlip(panelIds, nextScreen){
  const panels = panelIds.map(id => document.getElementById(id));
  const flipped = panels.map(()=>false);

  panels.forEach((panel, idx)=>{
    if(!panel) return;

    const activate = (ev) => {
      if(panel.classList.contains('flipped')) return;
      panel.classList.add('flipped');
      flipped[idx] = true;

      // try to start audio on interaction as well
      tryPlayAudio().catch(()=>{});

      if(flipped.every(Boolean)){
        setTimeout(()=> showScreen(nextScreen), 5000);
      }
    };

    panel.addEventListener('click', activate, {passive:true});
    panel.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); activate(); } });

    // stop back clicks from bubbling
    const back = panel.querySelector('.back');
    if(back) back.addEventListener('click', e=> e.stopPropagation(), {passive:true});
  });
}

setupFlip(['p2-1','p2-2','p2-3'],'screen3');
setupFlip(['p4-1','p4-2','p4-3'],'screen5');

/* ------------ SCREEN 5: slideshow + looping lines ------------ */
let slideTimer = null;
function startSlides(){
  const slides = Array.from(document.querySelectorAll('.slide'));
  if(!slides.length) return;
  let idx = 0;
  slides.forEach(s=>s.classList.remove('show'));
  slides[0].classList.add('show');
  if(slideTimer) clearInterval(slideTimer);
  slideTimer = setInterval(()=>{
    slides[idx].classList.remove('show');
    idx = (idx + 1) % slides.length;
    slides[idx].classList.add('show');
  }, 2000);
}

let finalLoopRunning = false;
function startFinalLoop(){
  if(finalLoopRunning) return;
  finalLoopRunning = true;
  const ids = ['line1','line2','line3','line4','line5'];
  const lines = ids.map(id=>document.getElementById(id));
  lines.forEach(el=>{ if(el){ el.style.opacity=0; el.style.transform='translateY(10px)'; }});
  startSlides();
  (function runCycle(){
    let delay = 400;
    lines.forEach((el)=>{
      if(!el) return;
      setTimeout(()=>{ el.style.transition='opacity 900ms ease, transform 900ms ease'; el.style.opacity=1; el.style.transform='translateY(0)'; }, delay);
      delay += 1800;
    });
    const outStart = delay + 1200;
    lines.forEach((el,i)=>{
      if(!el) return;
      setTimeout(()=>{ el.style.transition='opacity 900ms ease'; el.style.opacity=0; }, outStart + i*900);
    });
    const totalCycle = outStart + (lines.length * 900) + 500;
    setTimeout(runCycle, totalCycle);
  })();
}

/* init */
window.addEventListener('load', ()=>{
  showScreen('screen1');
  // clear any pre-flipped classes (safe)
  ['p2-1','p2-2','p2-3','p4-1','p4-2','p4-3'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.classList.remove('flipped');
  });
  // attempt initial audio unlock once (silent)
  tryPlayAudio().then(()=>{/* noop */});
});
</script>
</body>
</html>
